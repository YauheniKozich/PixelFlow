//
//  Lighting.h - –û–°–í–ï–©–ï–ù–ò–ï –ò –≠–§–§–ï–ö–¢–´: –ú–∞–≥–∏—è —Å–≤–µ—Ç–∞ –≤ –º–∏—Ä–µ —á–∞—Å—Ç–∏—Ü
//  ========================================================================
//
//  –≠–¢–û–¢ –§–ê–ô–õ - –•–£–î–û–ñ–ù–ò–ö –°–ò–°–¢–ï–ú–´!
//  –ó–¥–µ—Å—å —Ä–æ–∂–¥–∞–µ—Ç—Å—è –∫—Ä–∞—Å–æ—Ç–∞: —Å–≤–µ—á–µ–Ω–∏–µ, –±–ª–∏–∫–∏, —Ü–≤–µ—Ç–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã.
//
//  –ß–∞—Å—Ç–∏—Ü—ã - —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ —Ç–æ—á–∫–∏. –ù–æ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –æ—Å–≤–µ—â–µ–Ω–∏–µ–º
//  –æ–Ω–∏ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –∑–≤–µ–∑–¥–∞–º–∏, –æ–≥–Ω—è–º–∏, —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–º–∏ —Ä–∞–∑—Ä—è–¥–∞–º–∏!
//
//  –ú—ã —Å–æ–∑–¥–∞–µ–º –∞—Ç–º–æ—Å—Ñ–µ—Ä—É: –æ—Ç –º—è–≥–∫–æ–≥–æ —Å–≤–µ—á–µ–Ω–∏—è –¥–æ —è—Ä–æ—Å—Ç–Ω–æ–π –±—É—Ä–∏.
//  –ö–∞–∂–¥–∞—è —Ñ—É–Ω–∫—Ü–∏—è - –∫–∏—Å—Ç—å —Ö—É–¥–æ–∂–Ω–∏–∫–∞ –≤ –º–∏—Ä–µ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏.
//
//  –ê–≤—Ç–æ—Ä: Yauheni Kozich
//  –°–æ–∑–¥–∞–Ω: 31.10.25
//  –û–±–Ω–æ–≤–ª–µ–Ω: 2025-01-10 - –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–¥—Ä–æ–±–Ω—ã–µ —Ä—É—Å—Å–∫–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
//
//  üìù –û–ü–ò–°–ê–ù–ò–ï: –°–æ–∑–¥–∞–Ω–æ –º–∞–ª–µ–Ω—å–∫–∏–º, –Ω–æ –Ω–µ –≥–ª—É–ø—ã–º –ò–ò –ø–æ–¥ —á—É—Ç–∫–∏–º —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ–º —á–µ–ª–æ–≤–µ–∫–∞
//  ü§ñ –ò–ò: –ü–æ–º–æ–≥–∞–ª —Å —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞–º–∏ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
//  üë®‚Äçüíª –ß–µ–ª–æ–≤–µ–∫: –û–ø—Ä–µ–¥–µ–ª—è–ª —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è
//

#ifndef Lighting_h
#define Lighting_h

#include <metal_stdlib>
#include "../Core/Common.h"
#include "../Core/Utils.h"
#include "../Compute/Simulation.h"
using namespace metal;

// ============================================================================
// –ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø - –ß–¢–û–ë–´ –ù–ï –ó–ê–ë–õ–£–î–ò–¢–¨–°–Ø
// ============================================================================

/*
    –ö–ê–ö –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨ –≠–¢–ò –§–£–ù–ö–¶–ò–ò:

    // –ü—Ä–æ—Å—Ç–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ —á–∞—Å—Ç–∏—Ü—ã
    float3 color = applyParticleGlow(baseColor, dist, glowPower, glowIntensity);

    // –ì–ª–æ–±–∞–ª—å–Ω–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ —Å—Ü–µ–Ω—ã
    float3 color = applyGlobalLight(baseColor, position, screenSize, lightColor, lightIntensity);

    // –ü–æ–ª–Ω–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ —Å —É—á–µ—Ç–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è
    float3 color = calculateParticle2DLighting(
        baseColor, position, screenSize, dist,
        params.time, params.state
    );

    // –ë—ã—Å—Ç—Ä–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
    float3 color = calculateSimple2DLighting(baseColor, dist, glowIntensity);

    –≠–¢–û –ö–ê–ö –ú–ï–ù–Æ –í –†–ï–°–¢–û–†–ê–ù–ï - –ë–ï–†–ò –ß–¢–û –•–û–ß–ï–®–¨! üçΩÔ∏è
*/

// ============================================================================
// –ö–û–ù–°–¢–ê–ù–¢–´ –û–°–í–ï–©–ï–ù–ò–Ø - –ü–ê–†–ê–ú–ï–¢–†–´ "–•–£–î–û–ñ–ï–°–¢–í–ï–ù–ù–û–ì–û –°–¢–ò–õ–Ø"
// ============================================================================

// –°–í–ï–ß–ï–ù–ò–ï (Glow) - –º—è–≥–∫–æ–µ —Å–∏—è–Ω–∏–µ –≤–æ–∫—Ä—É–≥ —á–∞—Å—Ç–∏—Ü
#define GLOW_FALLOFF_POWER 2.5      // –ö–∞–∫ –±—ã—Å—Ç—Ä–æ —É–≥–∞—Å–∞–µ—Ç —Å–≤–µ—á–µ–Ω–∏–µ (–≤—ã—à–µ = —Ä–µ–∑—á–µ)
#define GLOW_BASE_INTENSITY 0.4     // –ë–∞–∑–æ–≤–∞—è —è—Ä–∫–æ—Å—Ç—å —Å–≤–µ—á–µ–Ω–∏—è
#define GLOW_MAX_INTENSITY 1.0      // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —è—Ä–∫–æ—Å—Ç—å (–∑–∞—â–∏—Ç–∞ –æ—Ç –æ—Å–ª–µ–ø–ª–µ–Ω–∏—è)

// –ì–õ–û–ë–ê–õ–¨–ù–û–ï –û–°–í–ï–©–ï–ù–ò–ï - –æ–±—â–µ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ –≤—Å–µ–π —Å—Ü–µ–Ω—ã
#define GLOBAL_LIGHT_INTENSITY 0.3   // –°–∏–ª–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å–≤–µ—Ç–∞
#define GLOBAL_LIGHT_FALLOFF 0.001   // –ö–∞–∫ –±—ã—Å—Ç—Ä–æ —Å–≤–µ—Ç —É–≥–∞—Å–∞–µ—Ç —Å —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ–º

// –ë–õ–£–ú (Bloom) - —ç—Ñ—Ñ–µ–∫—Ç –ø–µ—Ä–µ—ç–∫—Å–ø–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —è—Ä–∫–∏—Ö –æ–±–ª–∞—Å—Ç–µ–π
#define BLOOM_THRESHOLD 0.8          // –ü–æ—Ä–æ–≥ —è—Ä–∫–æ—Å—Ç–∏ –¥–ª—è –±–ª—É–º-—ç—Ñ—Ñ–µ–∫—Ç–∞
#define BLOOM_INTENSITY 0.5          // –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –±–ª—É–º-—Å–≤–µ—á–µ–Ω–∏—è
#define BLOOM_RADIUS 1.5             // "–†–∞–∑–º–µ—Ä" –±–ª—É–º-—ç—Ñ—Ñ–µ–∫—Ç–∞

// –ê–ú–ë–ò–ï–ù–¢–ù–û–ï –û–°–í–ï–©–ï–ù–ò–ï - –±–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å –æ—Å–≤–µ—â–µ–Ω–Ω–æ—Å—Ç–∏
#define AMBIENT_LIGHT_MIN 0.1        // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –æ–∫—Ä—É–∂–∞—é—â–∞—è –æ—Å–≤–µ—â–µ–Ω–Ω–æ—Å—Ç—å
#define AMBIENT_LIGHT_MAX 0.3        // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –æ–∫—Ä—É–∂–∞—é—â–∞—è –æ—Å–≤–µ—â–µ–Ω–Ω–æ—Å—Ç—å

// –û–°–í–ï–©–ï–ù–ò–ï –í –ë–£–†–Æ - —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
#define STORM_FLASH_INTENSITY 2.0    // –Ø—Ä–∫–æ—Å—Ç—å —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏—Ö –≤—Å–ø—ã—à–µ–∫
#define STORM_AMBIENT_BOOST 0.5     // –£—Å–∏–ª–µ–Ω–∏–µ –æ–∫—Ä—É–∂–∞—é—â–µ–≥–æ —Å–≤–µ—Ç–∞ –≤ –±—É—Ä—é

// ============================================================================
// –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò –û–°–í–ï–©–ï–ù–ò–Ø - –ë–ê–ó–û–í–´–ï "–ö–ò–°–¢–ò"
// ============================================================================

/*
    –†–ê–°–ß–ï–¢ –°–í–ï–ß–ï–ù–ò–Ø - —Å–µ—Ä–¥—Ü–µ –≤—Å–µ—Ö —Å–≤–µ—Ç–æ–≤—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤

    –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–µ—Ç –ø–ª–∞–≤–Ω–æ–µ —É–≥–∞—Å–∞–Ω–∏–µ —Å–≤–µ—Ç–∞ –æ—Ç —Ü–µ–Ω—Ç—Ä–∞ —á–∞—Å—Ç–∏—Ü—ã.
    dist = 0.0 (—Ü–µ–Ω—Ç—Ä) ‚Üí 1.0 (–∫—Ä–∞–π —á–∞—Å—Ç–∏—Ü—ã)
    power - –∫–∞–∫ —Ä–µ–∑–∫–æ —É–≥–∞—Å–∞–µ—Ç —Å–≤–µ—Ç
    intensity - –Ω–∞—Å–∫–æ–ª—å–∫–æ —è—Ä–∫–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ
*/
static inline float calculateGlow(float dist, float power, float intensity) {
    // –ë–∞–∑–æ–≤–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ: —è—Ä—á–µ –≤ —Ü–µ–Ω—Ç—Ä–µ, —Ç—É—Å–∫–Ω–µ–µ—Ç –∫ –∫—Ä–∞—è–º
    float glow = 1.0 - dist;

    // –í–æ–∑–≤–æ–¥–∏–º –≤ —Å—Ç–µ–ø–µ–Ω—å –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è —Ä–µ–∑–∫–æ—Å—Ç–∏ —É–≥–∞—Å–∞–Ω–∏—è
    // power = 1.0: –ª–∏–Ω–µ–π–Ω–æ–µ —É–≥–∞—Å–∞–Ω–∏–µ
    // power = 2.0: –∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–æ–µ (–±—ã—Å—Ç—Ä–µ–µ —É–≥–∞—Å–∞–µ—Ç)
    // power = 0.5: –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–π –∫–æ—Ä–µ–Ω—å (–º–µ–¥–ª–µ–Ω–Ω–µ–µ —É–≥–∞—Å–∞–µ—Ç)
    glow = pow(max(glow, 0.0), power);

    // –£–º–Ω–æ–∂–∞–µ–º –Ω–∞ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –∏ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –º–∞–∫—Å–∏–º—É–º
    return glow * clamp(intensity, 0.0, GLOW_MAX_INTENSITY);
}

/*
    –ü–†–ò–ú–ï–ù–ï–ù–ò–ï –°–í–ï–ß–ï–ù–ò–Ø –ö –¶–í–ï–¢–£

    –î–æ–±–∞–≤–ª—è–µ—Ç –±–µ–ª–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ –∫ –±–∞–∑–æ–≤–æ–º—É —Ü–≤–µ—Ç—É —á–∞—Å—Ç–∏—Ü—ã.
    –†–µ–∑—É–ª—å—Ç–∞—Ç - —á–∞—Å—Ç–∏—Ü–∞ –∫–∞–∫ –±—É–¥—Ç–æ —Å–≤–µ—Ç–∏—Ç—Å—è –∏–∑–Ω—É—Ç—Ä–∏!
*/
static inline float3 applyParticleGlow(float3 baseColor, float dist, float power, float intensity) {
    float glow = calculateGlow(dist, power, intensity);
    return baseColor + float3(glow);  // –î–æ–±–∞–≤–ª—è–µ–º –±–µ–ª–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ
}

/*
    –ó–ê–¢–£–•–ê–ù–ò–ï –°–í–ï–¢–ê –ü–û –†–ê–°–°–¢–û–Ø–ù–ò–Æ (2D –≤–µ—Ä—Å–∏—è)

    –í —Ä–µ–∞–ª—å–Ω–æ–º –º–∏—Ä–µ —Å–≤–µ—Ç —É–≥–∞—Å–∞–µ—Ç —Å —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ–º.
    –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –∏–º–∏—Ç–∏—Ä—É–µ—Ç —ç—Ç–æ –¥–ª—è 2D —á–∞—Å—Ç–∏—Ü.

    position - –≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —á–∞—Å—Ç–∏—Ü–∞
    lightPosition - –≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –∏—Å—Ç–æ—á–Ω–∏–∫ —Å–≤–µ—Ç–∞
    maxDistance - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–∞–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏—è —Å–≤–µ—Ç–∞
*/
static inline float calculateDistanceAttenuation2D(float2 position, float2 lightPosition, float maxDistance) {
    float distance = length(position - lightPosition);

    // –ï—Å–ª–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –Ω–µ –∑–∞–¥–∞–Ω–æ - —Å–≤–µ—Ç –≤–µ–∑–¥–µ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π
    if (maxDistance <= 0.0) {
        return 1.0; // –ù–µ—Ç –∑–∞—Ç—É—Ö–∞–Ω–∏—è
    }

    // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ (0 = —Ä—è–¥–æ–º, 1 = –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏)
    float normalizedDist = distance / maxDistance;

    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∏ –ø—Ä–∏–º–µ–Ω—è–µ–º –∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–æ–µ –∑–∞—Ç—É—Ö–∞–Ω–∏–µ
    float attenuation = 1.0 - saturate(normalizedDist);
    return attenuation * attenuation; // x¬≤ –¥–∞–µ—Ç –±–æ–ª–µ–µ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –∑–∞—Ç—É—Ö–∞–Ω–∏–µ
}

/*
    –ì–õ–û–ë–ê–õ–¨–ù–û–ï –û–°–í–ï–©–ï–ù–ò–ï - "–°–û–õ–ù–ï–ß–ù–´–ô –°–í–ï–¢" –°–¶–ï–ù–´

    –°–æ–∑–¥–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —Å–≤–µ—Ç–∞, –ø–∞–¥–∞—é—â–µ–≥–æ –Ω–∞ –≤—Å—é —Å—Ü–µ–Ω—É.
    –í 2D –º—ã –∏–º–∏—Ç–∏—Ä—É–µ–º —ç—Ç–æ –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º: —Å–≤–µ—Ç–ª–µ–µ —Å–≤–µ—Ä—Ö—É, —Ç–µ–º–Ω–µ–µ —Å–Ω–∏–∑—É.

    –≠—Ç–æ –¥–∞–µ—Ç –æ—â—É—â–µ–Ω–∏–µ –≥–ª—É–±–∏–Ω—ã –∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è!
*/
static inline float3 applyGlobalLight(
    float3 baseColor,     // –ò—Å—Ö–æ–¥–Ω—ã–π —Ü–≤–µ—Ç —á–∞—Å—Ç–∏—Ü—ã
    float2 position,      // –ü–æ–∑–∏—Ü–∏—è —á–∞—Å—Ç–∏—Ü—ã –Ω–∞ —ç–∫—Ä–∞–Ω–µ
    float2 screenSize,    // –†–∞–∑–º–µ—Ä—ã —ç–∫—Ä–∞–Ω–∞
    float3 lightColor,    // –¶–≤–µ—Ç —Å–≤–µ—Ç–∞ (RGB)
    float intensity       // –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –æ—Å–≤–µ—â–µ–Ω–∏—è
) {
    // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –ø–æ–∑–∏—Ü–∏—é (0,0 –≤ –ª–µ–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É ‚Üí 1,1 –≤ –ø—Ä–∞–≤–æ–º –Ω–∏–∂–Ω–µ–º)
    // –ó–∞—â–∏—Ç–∞ –æ—Ç –¥–µ–ª–µ–Ω–∏—è –Ω–∞ –Ω–æ–ª—å
    float2 normalizedPos = (screenSize.x > MIN_SCREEN_SIZE && screenSize.y > MIN_SCREEN_SIZE)
        ? position / screenSize
        : float2(0.5, 0.5);  // Fallback –≤ —Ü–µ–Ω—Ç—Ä

    // –°–æ–∑–¥–∞–µ–º –≥—Ä–∞–¥–∏–µ–Ω—Ç: —Å–≤–µ—Ç–ª–µ–µ –≤–≤–µ—Ä—Ö—É (y=0), —Ç–µ–º–Ω–µ–µ –≤–Ω–∏–∑—É (y=1)
    // 1.0 - normalizedPos.y: –∏–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º, —á—Ç–æ–±—ã –≤–µ—Ä—Ö –±—ã–ª —Å–≤–µ—Ç–ª–µ–µ
    float lightFactor = mix(0.7, 1.0, 1.0 - normalizedPos.y);

    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ü–≤–µ—Ç –∏ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å —Å–≤–µ—Ç–∞
    float3 lighting = lightColor * intensity * lightFactor;

    // –£–º–Ω–æ–∂–∞–µ–º –±–∞–∑–æ–≤—ã–π —Ü–≤–µ—Ç (1.0 + lighting = —É—Å–∏–ª–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞)
    return baseColor * (1.0 + lighting);
}

/*
    –ê–ú–ë–ò–ï–ù–¢–ù–ê–Ø –û–ö–ö–õ–Æ–ó–ò–Ø - "–¢–ï–ù–¨ –û–¢ –¢–û–õ–ü–´"

    –ò–º–∏—Ç–∏—Ä—É–µ—Ç —Ç–æ, –∫–∞–∫ —á–∞—Å—Ç–∏—Ü—ã –∑–∞—Ç–µ–Ω—è—é—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞.
    –í –ø–ª–æ—Ç–Ω—ã—Ö —Å–∫–æ–ø–ª–µ–Ω–∏—è—Ö —á–∞—Å—Ç–∏—Ü—ã –∫–∞–∂—É—Ç—Å—è —Ç–µ–º–Ω–µ–µ.

    particleDensity - —Å–∫–æ–ª—å–∫–æ —á–∞—Å—Ç–∏—Ü —Ä—è–¥–æ–º (0 = –ø—É—Å—Ç–æ, 1+ = —Ç–æ–ª–ø–∞)
*/
static inline float calculateAmbientOcclusion2D(float2 position, float particleDensity) {
    // –ß–µ–º –±–æ–ª—å—à–µ —á–∞—Å—Ç–∏—Ü - —Ç–µ–º —Ç–µ–º–Ω–µ–µ (–Ω–æ –Ω–µ —á–µ—Ä–Ω–µ–µ –º–∏–Ω–∏–º—É–º–∞)
    float ao = 1.0 - saturate(particleDensity * 0.1);

    // –ò–Ω—Ç–µ—Ä–ø–æ–ª–∏—Ä—É–µ–º –º–µ–∂–¥—É –º–∏–Ω –∏ –º–∞–∫—Å –æ–∫—Ä—É–∂–∞—é—â–∏–º —Å–≤–µ—Ç–æ–º
    return mix(AMBIENT_LIGHT_MIN, AMBIENT_LIGHT_MAX, ao);
}

// ============================================================================
// –ü–†–û–î–í–ò–ù–£–¢–´–ï –≠–§–§–ï–ö–¢–´ - –ú–ê–ì–ò–Ø –í–ò–ó–£–ê–õ–û–í
// ============================================================================

/*
    –ë–õ–£–ú-–≠–§–§–ï–ö–¢ - "–°–í–ï–†–•–™–Ø–†–ö–ò–ï" –û–ë–õ–ê–°–¢–ò

    –ò–º–∏—Ç–∏—Ä—É–µ—Ç —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é —Å –ø–µ—Ä–µ—ç–∫—Å–ø–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —è—Ä–∫–∏–º–∏ –æ–±–ª–∞—Å—Ç—è–º–∏.
    –û—á–µ–Ω—å —è—Ä–∫–∏–µ —á–∞—Å—Ç–∏—Ü—ã "—Ä–∞–∑–ª–∏–≤–∞—é—Ç—Å—è" —Å–≤–µ—Ç–æ–º –≤–æ–∫—Ä—É–≥ —Å–µ–±—è.

    –≠—Ç–æ –¥–µ–ª–∞–µ—Ç —Å—Ü–µ–Ω—É –±–æ–ª–µ–µ –¥—Ä–∞–º–∞—Ç–∏—á–Ω–æ–π –∏ –∫–∏–Ω–µ–º–∞—Ç–æ–≥—Ä–∞—Ñ–∏—á–Ω–æ–π!
*/
static inline float3 applyBloomEffect(float3 color, float dist) {
    // –í—ã—á–∏—Å–ª—è–µ–º —è—Ä–∫–æ—Å—Ç—å —Ü–≤–µ—Ç–∞ (–≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ–º–∞—è —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–º –≥–ª–∞–∑–æ–º)
    float brightness = dot(color, float3(0.299, 0.587, 0.114)); // RGB ‚Üí —è—Ä–∫–æ—Å—Ç—å

    // –ï—Å–ª–∏ —Ü–≤–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —è—Ä–∫–∏–π - –ø—Ä–∏–º–µ–Ω—è–µ–º –±–ª—É–º
    if (brightness > BLOOM_THRESHOLD) {
        // –í—ã—á–∏—Å–ª—è–µ–º "–ª–∏—à–Ω—é—é" —è—Ä–∫–æ—Å—Ç—å
        float bloomAmount = (brightness - BLOOM_THRESHOLD) / (1.0 - BLOOM_THRESHOLD);

        // –°–æ–∑–¥–∞–µ–º —Å–≤–µ—á–µ–Ω–∏–µ –±–ª—É–º-—ç—Ñ—Ñ–µ–∫—Ç–∞
        float bloomGlow = calculateGlow(dist, 2.0, BLOOM_INTENSITY);

        // –î–æ–±–∞–≤–ª—è–µ–º —Ü–≤–µ—Ç–Ω–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ (—É–º–Ω–æ–∂–µ–Ω–Ω–æ–µ –Ω–∞ —Ä–∞–¥–∏—É—Å)
        float3 bloom = color * bloomAmount * bloomGlow * BLOOM_RADIUS;

        return color + bloom;
    }

    // –î–ª—è —Ç—É—Å–∫–ª—ã—Ö —Ü–≤–µ—Ç–æ–≤ - –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
    return color;
}

/*
    –†–ê–°–°–ï–ò–í–ê–ù–ò–ï –°–í–ï–¢–ê - "–°–û–õ–ù–ï–ß–ù–´–ï –õ–£–ß–ò"

    –ò–º–∏—Ç–∏—Ä—É–µ—Ç –∫–∞–∫ —Å–≤–µ—Ç —Ä–∞—Å—Å–µ–∏–≤–∞–µ—Ç—Å—è –≤ –≤–æ–∑–¥—É—Ö–µ –∏–ª–∏ –≤–æ–¥–µ.
    –ß–∞—Å—Ç–∏—Ü—ã –∫–∞–∫ –±—É–¥—Ç–æ —Å–æ–±–∏—Ä–∞—é—Ç –∏ –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç —Å–≤–µ—Ç.

    –°–æ–∑–¥–∞–µ—Ç –∞—Ç–º–æ—Å—Ñ–µ—Ä—É –≥–ª—É–±–∏–Ω—ã –∏ —Ä–µ–∞–ª–∏–∑–º–∞!
*/
static inline float3 applyLightScattering(
    float3 baseColor,     // –ë–∞–∑–æ–≤—ã–π —Ü–≤–µ—Ç
    float2 position,      // –ü–æ–∑–∏—Ü–∏—è —á–∞—Å—Ç–∏—Ü—ã
    float2 lightSource,   // –ì–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –∏—Å—Ç–æ—á–Ω–∏–∫ —Å–≤–µ—Ç–∞
    float intensity       // –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∞
) {
    // –í—ã—á–∏—Å–ª—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫ –∏—Å—Ç–æ—á–Ω–∏–∫—É —Å–≤–µ—Ç–∞
    float2 toLight = lightSource - position;
    float distance = length(toLight);

    // –†–∞—Å—Å–µ–∏–≤–∞–Ω–∏–µ —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –ø–∞–¥–∞–µ—Ç —Å —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ–º
    float scattering = exp(-distance * 0.001) * intensity;

    // –°–æ–∑–¥–∞–µ–º —Ç–µ–ø–ª—ã–π —Ä–∞—Å—Å–µ—è–Ω–Ω—ã–π —Å–≤–µ—Ç (–∂–µ–ª—Ç–æ–≤–∞—Ç—ã–π)
    float3 scatteredLight = float3(1.0, 0.9, 0.8) * scattering;

    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–º–Ω–æ–≥–æ —Ä–∞—Å—Å–µ—è–Ω–Ω–æ–≥–æ —Å–≤–µ—Ç–∞
    return baseColor + scatteredLight * 0.2;
}
/*
    –†–ò–ú-–û–°–í–ï–©–ï–ù–ò–ï - "–°–í–ï–ß–ï–ù–ò–ï –ü–û –ö–†–ê–Ø–ú"

    –ò–º–∏—Ç–∏—Ä—É–µ—Ç —Ç–æ, –∫–∞–∫ —Å–≤–µ—Ç –∑–∞–≥–∏–±–∞–µ—Ç—Å—è –≤–æ–∫—Ä—É–≥ –∫—Ä–∞–µ–≤ –æ–±—ä–µ–∫—Ç–æ–≤.
    –í 2D –º—ã —É–ø—Ä–æ—â–∞–µ–º: –∫—Ä–∞—è —á–∞—Å—Ç–∏—Ü —Å–≤–µ—Ç—è—Ç—Å—è —Å–∏–ª—å–Ω–µ–µ.

    –°–æ–∑–¥–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç –æ–±—ä–µ–º–∞ –∏ –≥–ª—É–±–∏–Ω—ã!
*/
static inline float3 applyRimLight(float3 baseColor, float dist, float3 rimColor, float rimPower) {
    // Rim —Å–∏–ª—å–Ω–µ–µ –Ω–∞ –∫—Ä–∞—è—Ö —á–∞—Å—Ç–∏—Ü—ã
    float rim = smoothstep(0.3, 1.0, dist);
    rim = pow(rim, rimPower);  // –í–æ–∑–≤–æ–¥–∏–º –≤ —Å—Ç–µ–ø–µ–Ω—å –¥–ª—è —Ä–µ–∑–∫–æ—Å—Ç–∏

    // –î–æ–±–∞–≤–ª—è–µ–º —Ü–≤–µ—Ç–Ω–æ–π rim-—Å–≤–µ—Ç
    return baseColor + rimColor * rim * 0.3;
}

// ============================================================================
// –ó–ê–í–ò–°–ò–ú–û–ï –û–¢ –°–û–°–¢–û–Ø–ù–ò–Ø –û–°–í–ï–©–ï–ù–ò–ï - –ê–î–ê–ü–¢–ò–í–ù–´–ï –≠–§–§–ï–ö–¢–´
// ============================================================================

/*
    –û–°–í–ï–©–ï–ù–ò–ï –ü–û –°–û–°–¢–û–Ø–ù–ò–Æ - "–ù–ê–°–¢–†–û–ï–ù–ò–ï" –°–ò–ú–£–õ–Ø–¶–ò–ò

    –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —Å–∏–º—É–ª—è—Ü–∏–∏,
    –æ—Å–≤–µ—â–µ–Ω–∏–µ –º–µ–Ω—è–µ—Ç—Å—è: —Å–ø–æ–∫–æ–π–Ω–æ–µ –≤ idle, —è—Ä–æ—Å—Ç–Ω–æ–µ –≤ –±—É—Ä–µ.

    –≠—Ç–æ –∫–∞–∫ –º—É–∑—ã–∫–∞: –∫–∞–∂–¥—ã–π —Ä–µ–∂–∏–º –∏–º–µ–µ—Ç —Å–≤–æ—é "–º–µ–ª–æ–¥–∏—é" —Å–≤–µ—Ç–∞!
*/
static inline float3 applyStateLighting(
    float3 baseColor,     // –ë–∞–∑–æ–≤—ã–π —Ü–≤–µ—Ç
    float2 position,      // –ü–æ–∑–∏—Ü–∏—è —á–∞—Å—Ç–∏—Ü—ã
    float2 screenSize,    // –†–∞–∑–º–µ—Ä—ã —ç–∫—Ä–∞–Ω–∞
    float dist,           // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç —Ü–µ–Ω—Ç—Ä–∞ —á–∞—Å—Ç–∏—Ü—ã
    float time,           // –ì–ª–æ–±–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
    int state             // –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏–º—É–ª—è—Ü–∏–∏
) {
    float3 result = baseColor;

    switch (state) {
        case SIMULATION_STATE_LIGHTNING_STORM: {
            // ‚ö° –≠–õ–ï–ö–¢–†–ò–ß–ï–°–ö–ê–Ø –ë–£–†–Ø - –≤—Å–ø—ã—à–∫–∏ –∏ –º–æ–ª–Ω–∏–∏!

            // –°–æ–∑–¥–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ –≤—Å–ø—ã—à–∫–∏ (–º–µ–Ω—è—é—Ç—Å—è –∫–∞–∂–¥—ã–µ 0.2 —Å–µ–∫—É–Ω–¥—ã)
            float flashSeed = floor(time * 5.0);
            float flash = hash(flashSeed) > 0.7 ? 1.0 : 0.0;  // 30% —à–∞–Ω—Å –≤—Å–ø—ã—à–∫–∏
            float flashIntensity = flash * STORM_FLASH_INTENSITY * hash(flashSeed + 1.0);

            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –æ–±—â—É—é –æ—Å–≤–µ—â–µ–Ω–Ω–æ—Å—Ç—å –≤ –±—É—Ä—é
            result *= (1.0 + STORM_AMBIENT_BOOST);

            // –î–æ–±–∞–≤–ª—è–µ–º —è—Ä–∫–∏–µ –≤—Å–ø—ã—à–∫–∏
            if (flash > 0.5) {
                float3 flashColor = float3(0.8, 0.9, 1.0) * flashIntensity;  // –ì–æ–ª—É–±–æ–π
                result += flashColor * (1.0 - dist);  // –°–∏–ª—å–Ω–µ–µ –≤ —Ü–µ–Ω—Ç—Ä–µ
            }

            // –≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–æ–µ rim-—Å–≤–µ—á–µ–Ω–∏–µ –ø–æ –∫—Ä–∞—è–º
            result = applyRimLight(result, dist, float3(0.3, 0.5, 1.0), 3.0);
            break;
        }

        case SIMULATION_STATE_COLLECTING:
        case SIMULATION_STATE_COLLECTED: {
            // üèÜ –†–ï–ñ–ò–ú –°–ë–û–†–ê - —Ç–µ–ø–ª–æ–µ, —É—Å–ø–æ–∫–∞–∏–≤–∞—é—â–µ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ

            // –ú—è–≥–∫–∏–π –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Å–≤–µ—Ç (—Ç–µ–ø–ª—ã–π, –∫–∞–∫ –∑–∞–∫–∞—Ç)
            float3 globalLight = applyGlobalLight(
                result, position, screenSize,
                float3(1.0, 0.95, 0.9),     // –¢–µ–ø–ª—ã–π —Ü–≤–µ—Ç
                GLOBAL_LIGHT_INTENSITY * 0.5 // –ù–µ —Å–ª–∏—à–∫–æ–º —è—Ä–∫–æ
            );
            result = globalLight;

            // –õ–µ–≥–∫–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ –¥–ª—è —É—é—Ç–∞
            float glow = calculateGlow(dist, 2.0, GLOW_BASE_INTENSITY * 0.7);
            result += float3(glow * 0.3);
            break;
        }

        case SIMULATION_STATE_CHAOTIC: {
            // üå™Ô∏è –•–ê–û–¢–ò–ß–ù–´–ô –†–ï–ñ–ò–ú - –¥–∏–Ω–∞–º–∏—á–Ω–æ–µ, –ø—É–ª—å—Å–∏—Ä—É—é—â–µ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ

            // –ü—É–ª—å—Å–∏—Ä—É—é—â–∞—è –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å (–∫–∞–∫ —Å–µ—Ä–¥—Ü–µ–±–∏–µ–Ω–∏–µ)
            float pulse = sin(time * 3.0) * 0.5 + 0.5;
            float dynamicIntensity = GLOW_BASE_INTENSITY * (0.8 + pulse * 0.4);

            // –û–°–ù–û–í–ù–û–ô –¶–í–ï–¢ –ß–ê–°–¢–ò–¶–´ + —Å–≤–µ—á–µ–Ω–∏–µ
            result = baseColor * (0.7 + pulse * 0.3);  // –ë–∞–∑–æ–≤—ã–π —Ü–≤–µ—Ç —Å –ø—É–ª—å—Å–∞—Ü–∏–µ–π
            result += calculateGlow(dist, GLOW_FALLOFF_POWER, dynamicIntensity);

            // –¶–≤–µ—Ç–æ–≤—ã–µ –≤–∞—Ä–∏–∞—Ü–∏–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–æ–∑–∏—Ü–∏–∏
            float2 normalizedPos = position / screenSize;
            float3 colorShift = float3(
                sin(normalizedPos.x * 3.14159 + time),        // –ö—Ä–∞—Å–Ω—ã–π
                cos(normalizedPos.y * 3.14159 + time * 0.7),  // –ó–µ–ª–µ–Ω—ã–π
                sin((normalizedPos.x + normalizedPos.y) * 2.0 + time * 1.3) // –°–∏–Ω–∏–π
            ) * 0.15;  // –£–º–µ—Ä–µ–Ω–Ω–∞—è –≤–∞—Ä–∏–∞—Ü–∏—è

            result += colorShift * pulse;
            break;
        }

        case SIMULATION_STATE_IDLE:
        default: {
            // üò¥ –†–ï–ñ–ò–ú –û–ñ–ò–î–ê–ù–ò–Ø - –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω–æ –∏ —Å–ø–æ–∫–æ–π–Ω–æ

            // –¢–æ–ª—å–∫–æ –±–∞–∑–æ–≤–æ–µ –æ–∫—Ä—É–∂–∞—é—â–µ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ
            float ambient = AMBIENT_LIGHT_MIN;
            result *= (1.0 + ambient);

            // –¢–∏—Ö–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ –¥–ª—è "–∂–∏–≤–æ—Å—Ç–∏"
            float glow = calculateGlow(dist, 2.0, GLOW_BASE_INTENSITY * 0.5);
            result += float3(glow * 0.2);
            break;
        }
    }

    return result;
}

// ============================================================================
// –ì–õ–ê–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –û–°–í–ï–©–ï–ù–ò–Ø - "–®–ï–§-–ü–û–í–ê–†"
// ============================================================================

/*
    –ü–û–õ–ù–û–ï –û–°–í–ï–©–ï–ù–ò–ï –ß–ê–°–¢–ò–¶–´ - –∫–æ–º–±–∏–Ω–∏—Ä—É–µ–º –≤—Å–µ —ç—Ñ—Ñ–µ–∫—Ç—ã!

    –≠—Ç–æ –≥–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –≤–º–µ—Å—Ç–µ.
    –û–Ω–∞ —É—á–∏—Ç—ã–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏–º—É–ª—è—Ü–∏–∏, –ø—Ä–∏–º–µ–Ω—è–µ—Ç –≤—Å–µ –Ω—É–∂–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã,
    –¥–æ–±–∞–≤–ª—è–µ—Ç –±–ª—É–º –∏ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç —è—Ä–∫–æ—Å—Ç—å.

    –†–µ–∑—É–ª—å—Ç–∞—Ç - –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ –æ—Å–≤–µ—â–µ–Ω–Ω–∞—è —á–∞—Å—Ç–∏—Ü–∞ —Å–æ –≤—Å–µ–º–∏ —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏!
*/
static inline float3 calculateParticle2DLighting(
    float3 baseColor,        // –ò—Å—Ö–æ–¥–Ω—ã–π —Ü–≤–µ—Ç —á–∞—Å—Ç–∏—Ü—ã
    float2 position,         // –ü–æ–∑–∏—Ü–∏—è –Ω–∞ —ç–∫—Ä–∞–Ω–µ
    float2 screenSize,       // –†–∞–∑–º–µ—Ä—ã —ç–∫—Ä–∞–Ω–∞
    float dist,              // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç —Ü–µ–Ω—Ç—Ä–∞ —á–∞—Å—Ç–∏—Ü—ã (0-1)
    float time,              // –ì–ª–æ–±–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
    int state,               // –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏–º—É–ª—è—Ü–∏–∏
    float brightnessBoost    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —É—Å–∏–ª–µ–Ω–∏–µ —è—Ä–∫–æ—Å—Ç–∏
) {
    // –ù–∞—á–∏–Ω–∞–µ–º —Å —É—Å–∏–ª–µ–Ω–Ω–æ–≥–æ –±–∞–∑–æ–≤–æ–≥–æ —Ü–≤–µ—Ç–∞
    float3 result = baseColor * brightnessBoost;

    // –ü—Ä–∏–º–µ–Ω—è–µ–º –æ—Å–≤–µ—â–µ–Ω–∏–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è
    result = applyStateLighting(result, position, screenSize, dist, time, state);

    // –î–æ–±–∞–≤–ª—è–µ–º –±–ª—É–º-—ç—Ñ—Ñ–µ–∫—Ç –¥–ª—è —è—Ä–∫–∏—Ö —á–∞—Å—Ç–∏—Ü
    result = applyBloomEffect(result, dist);

    // –§–∏–Ω–∞–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞: —Ü–≤–µ—Ç –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º
    result = max(result, float3(0.0));

    return result;
}

/*
    –ü–†–û–°–¢–û–ï –û–°–í–ï–©–ï–ù–ò–ï - –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

    –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –±—ã—Å—Ç—Ä–æ –∏ –ø—Ä–æ—Å—Ç–æ: —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ.
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–≥–¥–∞ –≤–∞–∂–Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å, –∞ –Ω–µ –∫—Ä–∞—Å–æ—Ç–∞ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤.
*/
static inline float3 calculateSimple2DLighting(
    float3 baseColor,        // –ë–∞–∑–æ–≤—ã–π —Ü–≤–µ—Ç
    float dist,              // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç —Ü–µ–Ω—Ç—Ä–∞
    float glowIntensity      // –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å —Å–≤–µ—á–µ–Ω–∏—è
) {
    float glow = calculateGlow(dist, GLOW_FALLOFF_POWER, glowIntensity);
    return baseColor + float3(glow);
}

/*
    –í–û–¢ –ò –í–°–ï! üé®

    –≠—Ç–æ—Ç —Ñ–∞–π–ª - –ø–∞–ª–∏—Ç—Ä–∞ —Ö—É–¥–æ–∂–Ω–∏–∫–∞ –≤ –º–∏—Ä–µ —á–∞—Å—Ç–∏—Ü.
    –ö–∞–∂–¥–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª—è–µ—Ç —à—Ç—Ä–∏—Ö –∫ –æ–±—â–µ–π –∫–∞—Ä—Ç–∏–Ω–µ.

    –û—Ç –ø—Ä–æ—Å—Ç–æ–≥–æ —Å–≤–µ—á–µ–Ω–∏—è –¥–æ —Å–ª–æ–∂–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –±—É—Ä–∏ -
    –∑–¥–µ—Å—å —Ä–æ–∂–¥–∞–µ—Ç—Å—è –≤–∏–∑—É–∞–ª—å–Ω–∞—è –º–∞–≥–∏—è PixelFlow!

    –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä—É–π, –∫–æ–º–±–∏–Ω–∏—Ä—É–π, —Å–æ–∑–¥–∞–≤–∞–π —à–µ–¥–µ–≤—Ä—ã! ‚ú®
*/

#endif /* Lighting_h */
