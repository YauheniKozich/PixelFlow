//
//  Simulation.h - –°–û–°–¢–û–Ø–ù–ò–Ø –°–ò–ú–£–õ–Ø–¶–ò–ò: –ü—É–ª—å—Å —Å–∏—Å—Ç–µ–º—ã PixelFlow
//  ============================================================
//
//  –≠–¢–û–¢ –§–ê–ô–õ - "–ì–û–°–£–î–ê–†–°–¢–í–û" –°–ò–°–¢–ï–ú–´!
//  –ó–¥–µ—Å—å –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏–º—É–ª—è—Ü–∏–∏ –∏ –ø—Ä–∞–≤–∏–ª–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤.
//
//  –ü—Ä–µ–¥—Å—Ç–∞–≤—å —Å–∏–º—É–ª—è—Ü–∏—é –∫–∞–∫ —á–µ–ª–æ–≤–µ–∫–∞:
//  - IDLE: —Å–ø–∏—Ç —Å–ø–æ–∫–æ–π–Ω–æ
//  - CHAOTIC: —Ç–∞–Ω—Ü—É–µ—Ç –±–µ–∑—É–º–Ω–æ
//  - COLLECTING: —Å–æ–±–∏—Ä–∞–µ—Ç –≤–µ—â–∏
//  - COLLECTED: –æ—Ç–¥—ã—Ö–∞–µ—Ç –ø–æ—Å–ª–µ —Ä–∞–±–æ—Ç—ã
//  - LIGHTNING_STORM: –≤ —ç–∫—Å—Ç–∞–∑–µ –æ—Ç –º–æ–ª–Ω–∏–π
//
//  –ó–¥–µ—Å—å –∂–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã, –ª–∏–º–∏—Ç—ã –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏.
//  –í—Å–µ, —á—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏ –º–µ–∂–¥—É CPU –∏ GPU.
//
//  –ê–≤—Ç–æ—Ä: Yauheni Kozich
//  –°–æ–∑–¥–∞–Ω: 31.10.25
//  –û–±–Ω–æ–≤–ª–µ–Ω: 2025-01-10 - –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–¥—Ä–æ–±–Ω—ã–µ —Ä—É—Å—Å–∫–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
//
//  üìù –û–ü–ò–°–ê–ù–ò–ï: –°–æ–∑–¥–∞–Ω–æ –º–∞–ª–µ–Ω—å–∫–∏–º, –Ω–æ –Ω–µ –≥–ª—É–ø—ã–º –ò–ò –ø–æ–¥ —á—É—Ç–∫–∏–º —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ–º —á–µ–ª–æ–≤–µ–∫–∞
//  ü§ñ –ò–ò: –ü–æ–º–æ–≥–∞–ª —Å —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞–º–∏ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
//  üë®‚Äçüíª –ß–µ–ª–æ–≤–µ–∫: –û–ø—Ä–µ–¥–µ–ª—è–ª —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è
//

#ifndef Simulation_h
#define Simulation_h

#include <metal_stdlib>
using namespace metal;

// ============================================================================
// –°–û–°–¢–û–Ø–ù–ò–Ø –°–ò–ú–£–õ–Ø–¶–ò–ò - "–ù–ê–°–¢–†–û–ï–ù–ò–Ø" –°–ò–°–¢–ï–ú–´
// ============================================================================

/*
    –≠–¢–ò –ö–û–ù–°–¢–ê–ù–¢–´ - –û–°–ù–û–í–ê –õ–û–ì–ò–ö–ò!
    –û–Ω–∏ –î–û–õ–ñ–ù–´ —Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å enum –≤ ParticleSystem.swift!

    –ö–∞–∂–¥–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç:
    - –ö–∞–∫ –¥–≤–∏–≥–∞—é—Ç—Å—è —á–∞—Å—Ç–∏—Ü—ã
    - –ö–∞–∫–∏–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è
    - –ö–∞–∫ –≤–µ–¥–µ—Ç —Å–µ–±—è –æ—Å–≤–µ—â–µ–Ω–∏–µ
    - –ö–∞–∫–∏–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –≤–æ–∑–º–æ–∂–Ω—ã
*/

// –†–ï–ñ–ò–ú –û–ñ–ò–î–ê–ù–ò–Ø - —Å–∏—Å—Ç–µ–º–∞ —Å–ø–∏—Ç
constant int SIMULATION_STATE_IDLE = 0;

/*
    –ß–∞—Å—Ç–∏—Ü—ã —Å–ª–µ–≥–∫–∞ —à–µ–≤–µ–ª—è—Ç—Å—è, –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ.
    –≠–Ω–µ—Ä–≥–∏—è –Ω–∏–∑–∫–∞—è, –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è.
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç.
*/

//  –•–ê–û–¢–ò–ß–ù–´–ô –†–ï–ñ–ò–ú - —Ç–∞–Ω–µ—Ü –±–µ–∑—É–º–∏—è
constant int SIMULATION_STATE_CHAOTIC = 1;

/*
    –ß–∞—Å—Ç–∏—Ü—ã –∫—Ä—É–∂–∞—Ç –≤ –≤–∏—Ö—Ä–µ, –ø–æ–ª—É—á–∞—é—Ç –∏–º–ø—É–ª—å—Å—ã, —Ö–∞–æ—Ç–∏—á–Ω–æ –¥–≤–∏–≥–∞—é—Ç—Å—è.
    –ü–æ–ª–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è, —è—Ä–∫–∏–µ —ç—Ñ—Ñ–µ–∫—Ç—ã, –ø—É–ª—å—Å–∏—Ä—É—é—â–µ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ.
    "–¢–∞–Ω—Ü—ã –¥–æ —É–ø–∞–¥—É" –¥–ª—è —á–∞—Å—Ç–∏—Ü!
*/

//  –†–ï–ñ–ò–ú –°–ë–û–†–ê - —á–∞—Å—Ç–∏—Ü—ã –ª–µ—Ç—è—Ç –∫ —Ü–µ–ª—è–º
constant int SIMULATION_STATE_COLLECTING = 2;

/*
    –ß–∞—Å—Ç–∏—Ü—ã –ø–ª–∞–≤–Ω–æ –¥–≤–∏–∂—É—Ç—Å—è –∫ —Å–≤–æ–∏–º –ø–æ–∑–∏—Ü–∏—è–º –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏.
    –°–ø–æ–∫–æ–π–Ω–æ–µ, –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ.
    –ó–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–≥–¥–∞ –≤—Å–µ —á–∞—Å—Ç–∏—Ü—ã –Ω–∞ –º–µ—Å—Ç–µ.
*/

//  –°–û–ë–†–ê–ù–ù–û–ï –°–û–°–¢–û–Ø–ù–ò–ï - —Ü–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞
constant int SIMULATION_STATE_COLLECTED = 3;

/*
    –í—Å–µ —á–∞—Å—Ç–∏—Ü—ã –Ω–∞ —Å–≤–æ–∏—Ö –º–µ—Å—Ç–∞—Ö, –¥–≤–∏–∂–µ–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ.
    –°—Ç–∞–±–∏–ª—å–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, —Ç–µ–ø–ª–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ.
    "–ú–∏—Å—Å–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞!"
*/

//  –≠–õ–ï–ö–¢–†–ò–ß–ï–°–ö–ê–Ø –ë–£–†–Ø - –º–æ–ª–Ω–∏–∏ –∏ —Ö–∞–æ—Å
constant int SIMULATION_STATE_LIGHTNING_STORM = 4;

/*
    –≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–µ –ø–æ–ª—è, –≤—Å–ø—ã—à–∫–∏, —Ç—É—Ä–±—É–ª–µ–Ω—Ç–Ω–æ—Å—Ç—å!
    –ß–∞—Å—Ç–∏—Ü—ã –¥–µ—Ä–≥–∞—é—Ç—Å—è –æ—Ç "–º–æ–ª–Ω–∏–π", –º–µ–Ω—è—é—Ç —Ü–≤–µ—Ç–∞ –Ω–∞ —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–µ.
    –°–∞–º—ã–π –¥—Ä–∞–º–∞—Ç–∏—á–Ω—ã–π –∏ —ç–Ω–µ—Ä–≥–∏—á–Ω—ã–π —Ä–µ–∂–∏–º.
*/

// ============================================================================
// –ü–û–ú–û–©–ù–ò–ö–ò –î–õ–Ø –ê–ù–ê–õ–ò–ó–ê –°–û–°–¢–û–Ø–ù–ò–ô - "–ü–°–ò–•–û–õ–û–ì–ò–Ø" –°–ò–°–¢–ï–ú–´
// ============================================================================

/*
    –≠—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–º–æ–≥–∞—é—Ç –ø–æ–Ω—è—Ç—å "—Ö–∞—Ä–∞–∫—Ç–µ—Ä" —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è.
    –û–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π –æ –ø–æ–≤–µ–¥–µ–Ω–∏–∏ —á–∞—Å—Ç–∏—Ü.
*/

/*
    –ê–ö–¢–ò–í–ù–ê–Ø –õ–ò –°–ò–ú–£–õ–Ø–¶–ò–Ø?

    –í idle —Ä–µ–∂–∏–º–µ —á–∞—Å—Ç–∏—Ü—ã –ø–æ—á—Ç–∏ –Ω–µ –¥–≤–∏–≥–∞—é—Ç—Å—è - —ç—Ç–æ "–ø–∞—Å—Å–∏–≤–Ω—ã–π" —Ä–µ–∂–∏–º.
    –í–æ –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö - –∞–∫—Ç–∏–≤–Ω–æ —Ç–∞–Ω—Ü—É—é—Ç.
*/
static inline bool isActiveSimulationState(int state) {
    return state != SIMULATION_STATE_IDLE;
}

/*
    –≠–ù–ï–†–ì–ò–ß–ù–´–ô –õ–ò –†–ï–ñ–ò–ú?

    –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∂–∏–º—ã –æ—á–µ–Ω—å –∞–∫—Ç–∏–≤–Ω—ã–µ: —Ö–∞–æ—Å –∏ –±—É—Ä—è —Ç—Ä–µ–±—É—é—Ç –º–Ω–æ–≥–æ —ç–Ω–µ—Ä–≥–∏–∏.
    –°–±–æ—Ä - –±–æ–ª–µ–µ —Å–ø–æ–∫–æ–π–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å.
*/
static inline bool isEnergeticState(int state) {
    return state == SIMULATION_STATE_CHAOTIC ||
           state == SIMULATION_STATE_LIGHTNING_STORM;
}

/*
    –°–í–Ø–ó–ê–ù –õ–ò –° –°–ë–û–†–û–ú –ß–ê–°–¢–ò–¶?

    –î–≤–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫ —Å–±–æ—Ä—É: –ø—Ä–æ—Ü–µ—Å—Å —Å–±–æ—Ä–∞ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
*/
static inline bool isCollectionState(int state) {
    return state == SIMULATION_STATE_COLLECTING ||
           state == SIMULATION_STATE_COLLECTED;
}

/*
    –ú–ê–°–®–¢–ê–ë –í–†–ï–ú–ï–ù–ò –î–õ–Ø –ö–ê–ñ–î–û–ì–û –°–û–°–¢–û–Ø–ù–ò–Ø

    –í —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–∞—Ö –≤—Ä–µ–º—è —Ç–µ—á–µ—Ç –ø–æ-—Ä–∞–∑–Ω–æ–º—É:
    - –í idle: –º–µ–¥–ª–µ–Ω–Ω–µ–µ (—Å–æ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
    - –í chaotic: –Ω–æ—Ä–º–∞–ª—å–Ω–æ
    - –í collecting: —á—É—Ç—å –º–µ–¥–ª–µ–Ω–Ω–µ–µ –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏
    - –í collected: –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
*/
static inline float getStateTimeScale(int state) {
    switch (state) {
        case SIMULATION_STATE_IDLE:
            return 0.2;    // –ó–∞–º–µ–¥–ª–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è (—Å–æ–Ω)
        case SIMULATION_STATE_CHAOTIC:
            return 1.0;    // –ù–æ—Ä–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
        case SIMULATION_STATE_COLLECTING:
            return 0.8;    // –ß—É—Ç—å –º–µ–¥–ª–µ–Ω–Ω–µ–µ –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è
        case SIMULATION_STATE_COLLECTED:
            return 0.0;    // –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ (–∑–∞–º–æ—Ä–æ–∑–∫–∞)
        default:
            return 1.0;    // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é - –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å
    }
}

// ============================================================================
// –î–ï–§–û–õ–¢–ù–´–ï –ü–ê–†–ê–ú–ï–¢–†–´ - "–§–ê–ë–†–ò–ß–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò"
// ============================================================================

/*
    –≠—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–æ–≥–¥–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–µ –∑–∞–¥–∞–Ω—ã —è–≤–Ω–æ.
    –û–Ω–∏ –ø–æ–¥–æ–±—Ä–∞–Ω—ã –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π –∏ –∫—Ä–∞—Å–∏–≤–æ–π —Ä–∞–±–æ—Ç—ã.
*/

// –í–†–ï–ú–ï–ù–ù–´–ï –ò–ù–¢–ï–†–í–ê–õ–´ - —Ä–∏—Ç–º —Å–∏–º—É–ª—è—Ü–∏–∏
constant float DEFAULT_DELTA_TIME = 0.016666667;    // 60 FPS (1/60 —Å–µ–∫—É–Ω–¥—ã)
constant float MIN_DELTA_TIME = 0.0001;             // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —à–∞–≥ (–∑–∞—â–∏—Ç–∞ –æ—Ç –¥–µ–ª–µ–Ω–∏—è –Ω–∞ 0)
constant float MAX_DELTA_TIME = 0.1;                // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —à–∞–≥ (–∑–∞—â–∏—Ç–∞ –æ—Ç "—Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏–∏")

// –ê–ª–∏–∞—Å—ã –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ (—Å—Ç–∞—Ä—ã–π –∫–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç–∏ –∏–º–µ–Ω–∞)
#define DEFAULT_DT DEFAULT_DELTA_TIME
#define MIN_DT MIN_DELTA_TIME
#define MAX_DT MAX_DELTA_TIME

// –ü–ê–†–ê–ú–ï–¢–†–´ –°–ë–û–†–ê - –∫–∞–∫ —á–∞—Å—Ç–∏—Ü—ã –Ω–∞—Ö–æ–¥—è—Ç —Å–≤–æ–∏ –º–µ—Å—Ç–∞
constant float COLLECTION_SPEED_BASE = 0.005;       // –ë–∞–∑–æ–≤–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –¥–≤–∏–∂–µ–Ω–∏—è –∫ —Ü–µ–ª–∏
constant float COLLECTION_THRESHOLD_DEFAULT = 0.99; // 99% —á–∞—Å—Ç–∏—Ü –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–±—Ä–∞–Ω—ã

// –§–ò–ó–ò–ß–ï–°–ö–ò–ï –ö–û–ù–°–¢–ê–ù–¢–´ - —Ä–µ–∞–ª–∏–∑–º –¥–≤–∏–∂–µ–Ω–∏—è
constant float BOUNCE_DAMPING_DEFAULT = 0.8;        // –ü–æ—Ç–µ—Ä—è —Å–∫–æ—Ä–æ—Å—Ç–∏ –ø—Ä–∏ –æ—Ç—Å–∫–æ–∫–µ
constant float VELOCITY_DAMPING_DEFAULT = 0.95;     // –û–±—â–µ–µ –∑–∞–º–µ–¥–ª–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏

// –†–ê–ó–ú–ï–†–´ –ß–ê–°–¢–ò–¶ - –æ—Ç —Ç–æ—á–∫–∏ –¥–æ –∑–≤–µ–∑–¥–æ—á–∫–∏
constant float MIN_PARTICLE_SIZE_DEFAULT = 1.5;     // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä (–ø–∏–∫—Å–µ–ª–∏)
constant float MAX_PARTICLE_SIZE_DEFAULT = 8.0;     // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä (–ø–∏–∫—Å–µ–ª–∏)

// –ú–ê–¢–ï–ú–ê–¢–ò–ß–ï–°–ö–ò–ï –ö–û–ù–°–¢–ê–ù–¢–´ - –æ—Å–Ω–æ–≤–∞ —Ç—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏–∏
constant float PI = 3.141592654;           // –ü–∏ (œÄ)
constant float TWO_PI = 6.283185307;       // 2œÄ (–ø–æ–ª–Ω—ã–π –∫—Ä—É–≥)
constant float HALF_PI = 1.570796327;      // œÄ/2 (90 –≥—Ä–∞–¥—É—Å–æ–≤)

// –ó–ê–©–ò–¢–ù–´–ï –ö–û–ù–°–¢–ê–ù–¢–´ - –æ—Ç –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ
#define MIN_VECTOR_LENGTH 0.0001     // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –≤–µ–∫—Ç–æ—Ä–∞ (–∑–∞—â–∏—Ç–∞ –æ—Ç 0)
#define MAX_FLOAT_VALUE 1e10         // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ float
#define MIN_SCREEN_SIZE 0.0001       // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —ç–∫—Ä–∞–Ω–∞

// –ñ–ò–ó–ù–ï–ù–ù–´–ô –¶–ò–ö–õ –ß–ê–°–¢–ò–¶ - —Ñ–ª–∞–≥–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–π
#define PARTICLE_ALIVE 0.0           // –ß–∞—Å—Ç–∏—Ü–∞ –∂–∏–≤–∞ –∏ –∞–∫—Ç–∏–≤–Ω–∞
#define PARTICLE_COLLECTED -1.0      // –ß–∞—Å—Ç–∏—Ü–∞ —Å–æ–±—Ä–∞–Ω–∞ –∏ –∑–∞–º–æ—Ä–æ–∂–µ–Ω–∞

// ============================================================================
// –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò - –ò–ù–°–¢–†–£–ú–ï–ù–¢–´ –†–ê–ó–†–ê–ë–û–¢–ß–ò–ö–ê
// ============================================================================

static inline int getSimulationStateValue(int state) {
    return state; // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã —É–∂–µ –∏–º–µ—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
}

static inline bool canTransitionToState(int currentState, int targetState) {
    // –í IDLE –º–æ–∂–Ω–æ –ø–µ—Ä–µ–π—Ç–∏ –∏–∑ –ª—é–±–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è (—Å—Ç–æ–ø/—Å–±—Ä–æ—Å)
    if (targetState == SIMULATION_STATE_IDLE) {
        return true;
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    switch (currentState) {
        case SIMULATION_STATE_IDLE:
            // –ò–∑ –æ—Ç–¥—ã—Ö–∞ –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –Ω–∞—á–∞—Ç—å —Ö–∞–æ—Å
            return targetState == SIMULATION_STATE_CHAOTIC;

        case SIMULATION_STATE_CHAOTIC:
            // –ò–∑ —Ö–∞–æ—Å–∞ –º–æ–∂–Ω–æ –Ω–∞—á–∞—Ç—å —Å–±–æ—Ä –∏–ª–∏ –±—É—Ä—é
            return targetState == SIMULATION_STATE_COLLECTING ||
                   targetState == SIMULATION_STATE_LIGHTNING_STORM;

        case SIMULATION_STATE_COLLECTING:
            // –°–±–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –≤ collected
            return targetState == SIMULATION_STATE_COLLECTED;

        case SIMULATION_STATE_COLLECTED:
            // –ü–æ—Å–ª–µ —Å–±–æ—Ä–∞ –º–æ–∂–Ω–æ –Ω–∞—á–∞—Ç—å –Ω–æ–≤—ã–π —Ö–∞–æ—Å
            return targetState == SIMULATION_STATE_CHAOTIC;

        case SIMULATION_STATE_LIGHTNING_STORM:
            // –ò–∑ –±—É—Ä–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ —Ö–∞–æ—Å
            return targetState == SIMULATION_STATE_CHAOTIC;

        default:
            // –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ - –∑–∞–ø—Ä–µ—â–∞–µ–º –ø–µ—Ä–µ—Ö–æ–¥
            return false;
    }
}

static inline int getStateDebugValue(int state) {
    return state;
}

static inline float calculateSafeDeltaTime(float requestedDeltaTime) {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ NaN –∏–ª–∏ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ—Å—Ç—å
    if (!isfinite(requestedDeltaTime)) {
        return DEFAULT_DELTA_TIME;
    }

    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–æ–ø—É—Å—Ç–∏–º—ã–º –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º
    return clamp(requestedDeltaTime, MIN_DELTA_TIME, MAX_DELTA_TIME);
}

// –ß–∞—Å—Ç–∏—Ü–∞ —Å–æ–±—Ä–∞–Ω–∞? (life –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ)
static inline bool isParticleCollected(float life) {
    return life < 0.0;
}

// –û—Ç–º–µ—Ç–∏—Ç—å —á–∞—Å—Ç–∏—Ü—É –∫–∞–∫ —Å–æ–±—Ä–∞–Ω–Ω—É—é
static inline void markParticleAsCollected(thread float& life) {
    life = PARTICLE_COLLECTED;
}

// –°–±—Ä–æ—Å–∏—Ç—å —á–∞—Å—Ç–∏—Ü—É –≤ –∂–∏–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
static inline void markParticleAsAlive(thread float& life) {
    life = PARTICLE_ALIVE;
}


constant int BOUNDARY_TYPE_BOUNCE = 0;
constant int BOUNDARY_TYPE_TOROIDAL = 1;
constant int BOUNDARY_TYPE_CLAMP = 2;


constant int INTEGRATION_METHOD_EULER = 0;
constant int INTEGRATION_METHOD_VERLET = 1;


#endif /* Simulation_h */
